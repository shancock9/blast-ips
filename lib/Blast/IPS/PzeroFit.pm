package Blast::IPS::PzeroFit;

# MIT License
# Copyright (c) 2018 Steven Hancock
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in all
# copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
# SOFTWARE.

use strict;
use warnings;
use 5.006;

use Carp;
our $rpzero_fit;

#####################################
# Fits to zero overpressure line path
#####################################

# returns a hash reference to the fits of the form:

# $rpzero_fit->{symmetry}->{gamma} = [ tPc0, t0, r0, t0_fit, r0_fit, z_inf, k, C ]

# These fits to the zero-pressure time history have the form z=z(r)

#   	z = z_inf*( 1-k/[r**(N/2)-C+k] )

# z_inf = limiting value of z=r-ct at long range (usually taken at about r=1.e6)
# r is the radius
# N is the symmetry and equals 0,1, or 2
# k, C = coeffients of the fit

# tPc0 = time at which central overpressures reaches 0
# (t0, r0) = time and radial loction of first p=0
#    normally tPc0 and t0 are very close
# (t0_fit, r0_fit) = time and radial location that the fit begins.
# The analytical fit is not valid before this point; instead
# we connect this point with a straight line the r-z plane back to (r=0, t=tPc0)

BEGIN {

    # Created with: ./update_pzero_fit.pl
    # Wed May  9 21:35:38 2018   Inspiron-3668

    # Additional error information in this table:
    # max-err = maximum relative error in positive phase duration over the entire range of the fit
    # rp_match = a radius at which the fit is matched (has zero error)
    # err_match = max error beyond radius rp_match
    # rs_ovp1 shock radius when shock overpressure ratio = 1
    # err_ovp1 = relative error in fit to positive phase duration when shock overpressure ratio =1

    my $rtable = [

        # [symmetry, gamma, tPc0, t0, r0, t0_fit, r0_fit, z_inf, k, C, max-err, rp_match, err_match, rs_ovp1, err_ovp1],
        [ 0, 1.1,  0.2393, 0.2393, 0.0435,  0.2427, 0.0435,  -0.199177, 0, 0, 0.0937, 0, 0.0875, 0.432, 0.0295, ],
        [ 0, 1.12, 0.297,  0.297,  0.0469,  0.2952, 0.0469,  -0.248283, 0, 0, 0.0819, 0, 0.076,  0.513, 0.0266, ],
        [ 0, 1.15, 0.3938, 0.3939, 0.05497, 0.3934, 0.05497, -0.338443, 0, 0, 0.0796, 0, 0.0731, 0.634, 0.0323, ],
        [ 0, 1.17, 0.4663, 0.4663, 0.05189, 0.4552, 0.05189, -0.403289, 0, 0, 0.073,  0, 0.0667, 0.713, 0.0316, ],
        [ 0, 1.2,  0.5894, 0.5895, 0.0554,  0.5787, 0.0554,  -0.523275, 0, 0, 0.0751, 0, 0.0682, 0.832, 0.0394, ],
        [ 0, 1.23, 0.7343, 0.7344, 0.05476, 0.715,  0.05476, -0.660206, 0, 0, 0.0715, 0, 0.0647, 0.948, 0.0423, ],
        [ 0, 1.25, 0.8463, 0.8465, 0.06871, 0.8422, 0.06871, -0.773501, 0, 0, 0.0754, 0, 0.0681, 1.03,  0.0494, ],
        [ 0, 1.3,  1.201,  1.201,  0.06397, 1.186,  0.06397, -1.12177,  0, 0, 0.0767, 0, 0.0693, 1.22,  0.0604, ],
        [ 0, 1.35, 1.721,  1.722,  0.0873,  1.729,  0.0873,  -1.64178,  0, 0, 0.0827, 0, 0.0751, 1.41,  0.0759, ],
        [ 0, 1.4,  2.551,  2.551,  0.06915, 2.542,  0.06915, -2.47273,  0, 0, 0.0909, 0, 0.0835, 1.6,   0.0936, ],
        [ 0, 1.45, 4.023,  4.024,  0.115,   5.039,  1.091,   -3.94822,  0, 0, 0.102,  0, 0.0951, 1.79,  0.11, ],
        [ 0, 1.5,  7.051,  7.051,  0.08062, 9.07,   2.087,   -6.983,    0, 0, 0.116,  0, 0.11,   1.98,  0.122, ],
        [ 0, 1.55, 14.9,   14.9,   0.1936,  19.75,  4.896,   -14.8508,  0, 0, 0.132,  0, 0.128,  2.17,  0.136, ],
        [ 0, 1.6,  47.38,  47.39,  0.4107,  65.01,  17.66,   -47.3467,  0, 0, 0.149,  0, 0.147,  2.35,  0.151, ],
        [
            1,        1.1,      0.1162, 0.1162, 0.1139, 0.1114, 0.1438, 0.0705641,
            0.170698, 0.234581, 0.0497, 0.163,  0.0175, 0.352,  0.00495,
        ],
        [
            1,        1.12,     0.125,  0.125, 0.1094, 0.1204, 0.1534, 0.0755746,
            0.170705, 0.258782, 0.0498, 0.176, 0.0174, 0.384,  0.00477,
        ],
        [
            1,        1.15,    0.1363, 0.1363, 0.1093, 0.1318, 0.1652, 0.0818918,
            0.169376, 0.28994, 0.05,   0.193,  0.0168, 0.427,  0.00416,
        ],
        [
            1,       1.17,     0.1427, 0.1427, 0.09356, 0.1385, 0.1716, 0.0854374,
            0.16786, 0.307947, 0.0498, 0.202,  0.0162,  0.453,  0.0036,
        ],
        [
            1,        1.2,      0.1512, 0.1512, 0.09447, 0.147, 0.1792, 0.0900452,
            0.165648, 0.331325, 0.0499, 0.216,  0.0151,  0.489, 0.00383,
        ],
        [
            1,        1.23,     0.1584, 0.1584, 0.08952, 0.1542, 0.1847, 0.0939174,
            0.162992, 0.351572, 0.0498, 0.227,  0.0139,  0.522,  0.00428,
        ],
        [
            1,        1.25,     0.1627, 0.1627, 0.09756, 0.1583, 0.1871, 0.0962113,
            0.161483, 0.363427, 0.0499, 0.234,  0.0131,  0.542,  0.00453,
        ],
        [
            1,        1.3,     0.1718, 0.1718, 0.07735, 0.166, 0.1885, 0.101045,
            0.157596, 0.38902, 0.05,   0.249,  0.0111,  0.591, 0.00498,
        ],
        [
            1,        1.35,     0.1792, 0.1792, 0.08246, 0.1683, 0.17, 0.104968,
            0.154434, 0.409745, 0.05,   0.262,  0.00926, 0.635,  0.00522,
        ],
        [
            1,        1.4,      0.1853, 0.1853, 0.07563, 0.2024, 0.1366, 0.108175,
            0.151645, 0.426923, 0.0496, 0.273,  0.00755, 0.675,  0.00527,
        ],
        [
            1,        1.45,     0.1903, 0.1903, 0.0723,  0.2086, 0.1535, 0.110828,
            0.149222, 0.441319, 0.0494, 0.282,  0.00602, 0.713,  0.00516,
        ],
        [
            1,        1.49,     0.1937, 0.1937, 0.0675,  0.2136, 0.1659, 0.112648,
            0.147571, 0.451232, 0.0496, 0.288,  0.00498, 0.742,  0.00498,
        ],
        [
            1,        1.5,      0.1947, 0.1948, 0.06618, 0.2152, 0.1692, 0.113205,
            0.147233, 0.453836, 0.0495, 0.29,   0.00492, 0.749,  0.00492,
        ],
        [
            1,        1.51,     0.1952, 0.1953, 0.07527, 0.216, 0.172, 0.113458,
            0.146786, 0.455728, 0.0489, 0.291,  0.00485, 0.756, 0.00485,
        ],
        [
            1,        1.55,     0.198,  0.198, 0.07512, 0.2211, 0.1828, 0.114957,
            0.145489, 0.463892, 0.0492, 0.296, 0.00458, 0.783,  0.00458,
        ],
        [
            1,        1.6,      0.2009, 0.2009, 0.06084, 0.2274, 0.1947, 0.116604,
            0.144123, 0.472818, 0.0498, 0.301,  0.00419, 0.816,  0.00419,
        ],
        [
            1,        1.65,     0.2033, 0.2033, 0.05234, 0.2334, 0.205, 0.118005,
            0.142912, 0.480538, 0.05,   0.306,  0.00372, 0.847,  0.00372,
        ],
        [
            1,        1.667,    0.204,  0.204, 0.04379, 0.2354, 0.2083, 0.11845,
            0.142599, 0.482907, 0.0499, 0.308, 0.00357, 0.857,  0.00357,
        ],
        [
            1,        1.7,      0.2053, 0.2053, 0.05517, 0.239, 0.2142, 0.119208,
            0.141843, 0.487253, 0.0498, 0.31,   0.00321, 0.877, 0.00321,
        ],
        [
            1,        1.8,      0.2083, 0.2083, 0.05288, 0.2489, 0.2282, 0.121199,
            0.140294, 0.498163, 0.0499, 0.317,  0.00213, 0.934,  0.00213,
        ],
        [
            1,        1.9,      0.2102, 0.2102, 0.03334, 0.2568, 0.2383, 0.122765,
            0.139348, 0.506455, 0.05,   0.321,  0.00266, 0.987,  0.00109,
        ],
        [
            1,        2,        0.2114, 0.2114, 0.03303, 0.2632, 0.2458, 0.123943,
            0.138568, 0.512852, 0.0499, 0.324,  0.0037,  1.04,   0.00103,
        ],
        [
            1,        2.2,      0.2121, 0.2121, 0.03841, 0.2719, 0.2547, 0.12557,
            0.137886, 0.521263, 0.0498, 0.326,  0.00542, 1.13,   0.00363,
        ],
        [
            1,        2.5,      0.2106, 0.2107, 0.03464, 0.2781, 0.259, 0.12685,
            0.138108, 0.527013, 0.05,   0.324,  0.00764, 1.26,   0.00759,
        ],
        [
            1,        3,        0.2049, 0.2049, 0.01979, 0.278, 0.2539, 0.127296,
            0.140949, 0.526289, 0.0499, 0.311,  0.0141,  1.44,  0.0138,
        ],
        [
            1,        3.5,      0.1978, 0.1978, 0.01307, 0.2717, 0.2422, 0.126558,
            0.145181, 0.519572, 0.0498, 0.295,  0.0201,  1.61,   0.0191,
        ],
        [
            1,        4,        0.1905, 0.1905, 0.01501, 0.263, 0.2279, 0.125175,
            0.150202, 0.510275, 0.05,   0.277,  0.0255,  1.76,  0.0236,
        ],
        [
            1,       4.5,      0.1835, 0.1835, 0.01444, 0.2533, 0.213, 0.123444,
            0.15597, 0.499904, 0.0499, 0.259,  0.0305,  1.89,   0.0274,
        ],
        [
            1,       5,        0.1769, 0.1769, 0.009818, 0.2437, 0.1988, 0.121463,
            0.16162, 0.489499, 0.0498, 0.243,  0.035,    2.02,   0.0305,
        ],
        [ 1, 5.5, 0.1708, 0.1708, 0.00268,  0.1077,  0.227,  0.119305, 0, 0, 0.234, 0, 0.182, 2.14, 0.0156, ],
        [ 1, 6,   0.1651, 0.1652, 0.0102,   0.09535, 0.2124, 0.117056, 0, 0, 0.234, 0, 0.176, 2.25, 0.0191, ],
        [ 1, 6.5, 0.1599, 0.1599, 0.003798, 0.0845,  0.1992, 0.114736, 0, 0, 0.234, 0, 0.171, 2.36, 0.0223, ],
        [ 1, 7,   0.1551, 0.1551, 0.007934, 0.07502, 0.1874, 0.112359, 0, 0, 0.233, 0, 0.166, 2.46, 0.025, ],
        [
            2,         1.1,      0.128,  0.128, 0.2117, 0.1245, 0.2513, 0.189067,
            0.0845201, 0.079092, 0.0498, 0.276, 0.0124, 0.445,  0.00362,
        ],
        [
            2,         1.12,      0.1337, 0.1337, 0.2134, 0.1308, 0.2629, 0.198884,
            0.0878435, 0.0892673, 0.0499, 0.292,  0.0124, 0.472,  0.00367,
        ],
        [
            2,         1.15,     0.1405, 0.1405, 0.2127, 0.1387, 0.277, 0.211123,
            0.0917614, 0.102789, 0.0499, 0.312,  0.0121, 0.506,  0.00358,
        ],
        [
            2,         1.17,     0.1441, 0.1441, 0.1961, 0.1431, 0.2847, 0.218082,
            0.0939733, 0.110679, 0.0498, 0.323,  0.0119, 0.526,  0.00347,
        ],
        [
            2,         1.2,      0.1485, 0.1485, 0.1985, 0.1485, 0.2941, 0.227141,
            0.0966848, 0.121477, 0.0499, 0.338,  0.0115, 0.554,  0.00326,
        ],
        [
            2,         1.23,     0.152,  0.152, 0.1756, 0.1529, 0.3016, 0.234937,
            0.0989319, 0.131088, 0.0499, 0.35,  0.0111, 0.578,  0.0035,
        ],
        [
            2,        1.25,     0.1538, 0.1538, 0.1711, 0.1554, 0.3057, 0.239567,
            0.100208, 0.136944, 0.0499, 0.358,  0.0108, 0.593,  0.00363,
        ],
        [
            2,        1.3,      0.1574, 0.1574, 0.182,  0.16,  0.3131, 0.24962,
            0.102881, 0.149945, 0.0499, 0.374,  0.0101, 0.627, 0.00389,
        ],
        [
            2,       1.35,     0.1597, 0.1597, 0.1676,  0.1628, 0.317, 0.25799,
            0.10495, 0.161125, 0.0499, 0.387,  0.00938, 0.658,  0.00409,
        ],
        [
            2,        1.4,     0.1611, 0.1611, 0.1387,  0.1641, 0.3177, 0.265111,
            0.106612, 0.17079, 0.05,   0.398,  0.00874, 0.685,  0.00425,
        ],
        [
            2,        1.45,     0.1617, 0.1617, 0.115,   0.1638, 0.3148, 0.271249,
            0.107899, 0.179314, 0.05,   0.407,  0.00811, 0.71,   0.00434,
        ],
        [
            2,        1.5,      0.1618, 0.1619, 0.137,   0.1616, 0.3065, 0.276633,
            0.108997, 0.186714, 0.05,   0.414,  0.00752, 0.733,  0.00441,
        ],
        [
            2,        1.55,     0.1615, 0.1616, 0.1334,  0.1784, 0.2045, 0.281399,
            0.109915, 0.193249, 0.0486, 0.421,  0.00696, 0.754,  0.00446,
        ],
        [
            2,        1.6,     0.1609, 0.1609, 0.08017, 0.1783, 0.2158, 0.285645,
            0.110654, 0.19908, 0.049,  0.426,  0.00642, 0.775,  0.00448,
        ],
        [
            2,       1.65,     0.16,   0.16, 0.1153,  0.1779, 0.2269, 0.28946,
            0.11127, 0.204257, 0.0488, 0.43, 0.00589, 0.794,  0.00447,
        ],
        [
            2,       1.667,    0.1596, 0.1596, 0.1094,  0.1782, 0.2301, 0.290679,
            0.11148, 0.205854, 0.0498, 0.431,  0.00572, 0.8,    0.00448,
        ],
        [
            2,        1.7,     0.1588, 0.1588, 0.09047, 0.1781, 0.2369, 0.292912,
            0.111794, 0.20885, 0.0499, 0.433,  0.00539, 0.812,  0.00445,
        ],
        [
            2,        1.8,     0.156,  0.1561, 0.09747, 0.1784, 0.256, 0.298946,
            0.112698, 0.21648, 0.0498, 0.438,  0.00443, 0.845,  0.00438,
        ],
        [
            2,        1.9,      0.1528, 0.1528, 0.08446, 0.1794, 0.2725, 0.304028,
            0.113394, 0.222461, 0.0498, 0.441,  0.00424, 0.876,  0.00424,
        ],
        [
            2,        2,        0.1493, 0.1493, 0.02565, 0.1808, 0.2862, 0.308379,
            0.113986, 0.227043, 0.0499, 0.442,  0.00405, 0.904,  0.00405,
        ],
        [
            2,        2.2,      0.1416, 0.1417, 0.06544, 0.1833, 0.3055, 0.315462,
            0.115117, 0.232751, 0.0499, 0.44,   0.00356, 0.955,  0.00356,
        ],
        [
            2,        2.5,      0.1298, 0.1298, 0.05973, 0.1837, 0.3187, 0.32329,
            0.117008, 0.234852, 0.0499, 0.43,   0.00259, 1.02,   0.00259,
        ],
        [
            2,        3,        0.1106, 0.1106, 0.02924, 0.1751, 0.3148, 0.331872,
            0.121701, 0.226331, 0.0499, 0.402,  0.00599, 1.11,   0.000876,
        ],
        [
            2,        3.5,      0.09277, 0.09281, 0.02904, 0.1584, 0.2921, 0.337175,
            0.129352, 0.207093, 0.0499,  0.363,   0.0104,  1.19,   0.00444,
        ],
        [
            2,        4,        0.07653, 0.07655, 0.01735, 0.1362, 0.2558, 0.340475,
            0.141293, 0.179321, 0.0499,  0.315,   0.0155,  1.26,   0.00935,
        ],
        [
            2,        4.5,      0.06165, 0.06166, 0.00791, 0.1101, 0.2069, 0.342405,
            0.159583, 0.143966, 0.0499,  0.256,   0.0219,  1.32,   0.0159,
        ],
        [
            2,        5,        0.04791, 0.04791, 0.004797, 0.08205, 0.1468, 0.343345,
            0.186311, 0.103491, 0.0499,  0.189,   0.0305,   1.37,    0.0243,
        ],
        [
            2,       5.5,       0.03509, 0.0351, 0.006395, 0.05695, 0.08497, 0.343517,
            0.21899, 0.0655187, 0.05,    0.122,  0.0441,   1.42,    0.0333,
        ],
        [
            2,        6,         0.02299, 0.023,  0.004431, 0.03773, 0.03262, 0.343078,
            0.250564, 0.0362949, 0.0499,  0.0683, 0.0561,   1.46,    0.0405,
        ],
        [
            2,        6.5,       0.01141, 0.01141, 0.001254, 0.01948, 0.001254, 0.342124,
            0.277242, 0.0152733, 0.0353,  0.028,   0.0648,   1.5,     0.0454,
        ],
    ];
    foreach my $item ( @{$rtable} ) {
        my ( $symmetry, $gamma, @vars ) = @{$item}[ 0 .. 9 ];
        $rpzero_fit->{$symmetry}->{$gamma} = [@vars];
    }
}
1;
